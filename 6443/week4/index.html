<!doctype html><html lang=en><head><meta charset=utf-8><title>04: sqli</title>
<meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=../reveal-js/dist/reset.css><link rel=stylesheet href=../reveal-js/dist/reveal.css><link rel=stylesheet href=../reveal-js/dist/theme/black.css id=theme><link rel=stylesheet href=../highlight-js/default.min.css></head><body><div class=reveal><div class=slides><section><h2 id=well-get-started-at-5-past>We&rsquo;ll get started at 5 past</h2></section><section data-noprocess data-shortcode-slide class=center><h1 id=week04>Week04</h1><h3 id=comp6443>COMP6443</h3></section><section><h2 id=upcoming-due-dates>Upcoming due dates?</h2><blockquote><p>Next Week</p></blockquote><ul><li>Monday during the lecture slot: mid-sem (0%)</li><li>sun 11:59pm<ul><li>report01 (20%)</li><li>topic03 challenges</li></ul></li></ul></section><section><h2 id=sql-squilly><del>SQL</del> SQUILLY</h2><section data-shortcode-section><blockquote><p>Structured Query Language</p></blockquote><ul><li>Basically how you can find stuff in a database.
Some examples of &ldquo;Flavours&rdquo; (different implementations of SQL) include<ul><li>SQLite, PostgreSQL, MySQL, MSSQL Server</li></ul></li></ul></section><section><p>Databases</p><ul><li>Tables<ul><li>Defined through columns</li><li>Contain records<ul><li>each record potentially containing a value for every cell.</li></ul></li></ul></li></ul></section><section><p><img src=../assets/img/week04/database_visualised.png alt></p></section><section><p>How do I use SQL? Well you just &ldquo;QUERY&rdquo; for what you want!</p></section><section><blockquote><blockquote><p>Queries</p></blockquote></blockquote><ul><li><code>SELECT &lt;column> FROM &lt;table>;</code> -> Returns all the values of &ldquo;column&rdquo; in the table.</li><li><code>INSERT INTO table (columna, columnb) VALUES (a, b);</code> -> Inserts some values into a table.</li><li><code>UPDATE table SET ... = ...</code> -> Updates values of a table.</li><li><del><code>DELETE FROM table ...</code></del> (<em>pls dont</em>)</li><li><code>-- a comment (also #)</code> -> Anything after the &ndash; is ignored.</li></ul></section><section><p>SELECT * FROM table WHERE &mldr; -> Select ALL THE COLUMNS from a table</p><ul><li><code>col = ...</code></li><li><code>col > ...</code></li><li><code>col &lt; ...</code></li><li><code>col &lt;> ... #</code> not equals (!=)</li><li><code>col LIKE ... #</code> regexp<ul><li><code>_</code> <code>(.)</code> and <code>%</code> <code>(.*)</code> are wildcards</li></ul></li></ul></section><section><p>SOME EXTRA COOL STUFF YOU CAN SELECT (WRITE THIS DOWN)</p></section><section><blockquote><p>Fingerprinting (What flavour am I using?)</p></blockquote><ul><li>work out the flavour/version<ul><li><strong>MySQL</strong>: <code>SELECT Version()</code></li><li><strong>SQLite</strong>: <code>SELECT sqlite_version()</code></li><li><strong>MSSQL</strong>: <code>SELECT @@Version</code></li></ul></li></ul></section><section><blockquote><p>Finding the schema</p></blockquote><ul><li>what tables exist, what do they look like?<ul><li><strong>MySQL</strong>: <code>SELECT * FROM information_schema.[tables|columns]</code></li><li><strong>SQLite</strong>: <code>SELECT * FROM sqlite_[master|schema]</code></li><li><strong>MSSQL</strong>: <code>SHOW TABLES; DESCRIBE &lt;table_name></code></li></ul></li></ul></section><section><p>Demo this in <code>/playground</code></p></section><section><p>Demo SQL Code</p><pre tabindex=0><code>SELECT * FROM sqlite_master
INSERT INTO users VALUES (5,&#39;jesse&#39;,&#39;merhi&#39;)
SELECT * FROM users UNION SELECT * FROM stock
</code></pre></section><section><h2 id=notes-on-unions>Notes on UNIONs</h2><ul><li>The query needs to extract the same number of columns from both tables</li><li>The data-type for the columns must be compatible</li><li>You can also UNION the same table</li></ul></section><section><pre tabindex=0><code>SELECT username, password FROM users UNION SELECT * FROM stock
</code></pre></section><section></section></section><section><h2 id=sqli-squilly-for-cool-kids>SQLi (Squilly for cool kids)</h2><section data-shortcode-section><h3 id=sql-injection>SQL Injection</h3><ul><li><p><em>TLDR</em>: blindly trusting user input is bad</p></li><li><p>What if we injected control characters which changed how the database interprets the query? e.g. inject our own <code>UNIONS/WHERES/etc</code></p></li><li><p>How could it tell the difference?</p></li></ul></section><section><h3 id=how-does-sqli-work>How does SQLi work</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> users <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>user</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;{input}&#39;</span> <span style=color:#66d9ef>AND</span> password <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;{...}&#39;</span>
</span></span></code></pre></div><p>Â </p><p>If our input was: <code>' OR 1=1 --</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>--                        vvvvvvvvvvvvvvvvvvvv
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> users <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>user</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span> <span style=color:#66d9ef>OR</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#75715e>--&#39;and password = &#39;...&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e>--                        ^^^^^^^^^^^^^^^^^^^^
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- user = &#39;&#39; is always false, but 1=1 is always true
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- so this will return every user from the database
</span></span></span></code></pre></div></section><section><h3 id=issues-you-may-encounter>Issues you may encounter</h3><ul><li>Syntax needs to be correct, or you&rsquo;ll throw an error<ul><li>so, determine syntax through errors/fingerprint</li></ul></li></ul><p>Common syntax errors:</p><ul><li>Single vs. Double quotes</li><li>Commenting character (&ndash;) vs #</li><li>Brackets! <code>((username = '{INPUT}' AND password = '{PASSWORD}'))</code></li></ul></section><section><ul><li>You have SQLi in <code>items</code>, but want <code>users</code><ul><li>find out the tables? (database schema)</li><li>include that table with a <code>UNION</code></li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> items <span style=color:#66d9ef>WHERE</span> item <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span> <span style=color:#66d9ef>UNION</span> <span style=color:#66d9ef>SELECT</span> username,password <span style=color:#66d9ef>FROM</span> users;<span style=color:#75715e>--;&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e>--                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
</span></span></span></code></pre></div></section></section><section><h1 id=sqli-demo>SQLi Demo</h1><blockquote><p>Back to /login</p></blockquote></section><section><h2 id=mitigations>Mitigations</h2><section data-shortcode-section><h3 id=defense>Defense</h3><ul><li>Reduce information disclosure<ul><li>Don&rsquo;t display error messages</li><li>Just fail or show a basic error message (e.g. <code>'username or password incorrect'</code>)</li></ul></li><li>Strip out malicious content (e.g. use a WAF)</li><li>Block requests with anything sus (<em>kinda bad UX</em>)</li></ul></section><section><h3 id=better-defence>Better defence</h3><ul><li>Don&rsquo;t use raw content<ul><li>Use parameterised queries rather than raw input</li><li>use an ORM (database as an object)</li></ul></li></ul><blockquote><p>Note: these have historically still been vulnerable, don&rsquo;t solely rely on them</p></blockquote></section><section><h3 id=offense>Offense</h3><ul><li>Content stripped?<ul><li>embed dummy characters (oORr)</li><li>use alternating case (WhErE)</li></ul></li><li>No response?<ul><li>Timing Attacks (IF success THEN sleep(1))</li><li>Error-based extraction (get the output in an error)</li><li>Boolean-based extraction (IF success THEN &mldr;)</li></ul></li></ul></section></section><section><h2 id=nosql-mongodb>NoSQL (MongoDB)</h2><ul><li>it&rsquo;s not sql so therefore no sqli right?<ul><li>yes but not yes</li><li>it&rsquo;s still vulnerable to injection</li></ul></li><li>not <em>necessarily</em> in the challenges</li></ul><blockquote><p>covered in the extended lecture</p></blockquote></section><section><h2 id=now-you>Now you</h2><ul><li>give the topic3 challenges a shot :)</li><li>get your report ready!!</li></ul></section></div></div><script type=text/javascript src=../reveal-hugo/object-assign.js></script><script src=../reveal-js/dist/reveal.js></script><script type=text/javascript src=../reveal-js/plugin/markdown/markdown.js></script><script type=text/javascript src=../reveal-js/plugin/highlight/highlight.js></script><script type=text/javascript src=../reveal-js/plugin/zoom/zoom.js></script><script type=text/javascript src=../reveal-js/plugin/notes/notes.js></script><script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams={},revealHugoPageParams={},revealHugoPlugins={plugins:[RevealMarkdown,RevealHighlight,RevealZoom,RevealNotes]},options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams),camelize(revealHugoPlugins));Reveal.initialize(options)</script></body></html>