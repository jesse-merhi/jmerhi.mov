<!doctype html><html lang=en><head><meta charset=utf-8><title>05: serverside</title>
<meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=../reveal-js/dist/reset.css><link rel=stylesheet href=../reveal-js/dist/reveal.css><link rel=stylesheet href=../reveal-js/dist/theme/black.css id=theme><link rel=stylesheet href=../highlight-js/default.min.css></head><body><div class=reveal><div class=slides><section><h2 id=well-get-started-at-1805>We&rsquo;ll get started at 18:05</h2></section><section data-noprocess data-shortcode-slide class=center><h1 id=week05>Week05</h1><h3 id=comp6443-h18a>COMP6443 H18A</h3></section><section><h1 id=house-cleaning>House cleaning</h1><section data-shortcode-section><h2 id=midterm>Midterm</h2><blockquote><p>How&rsquo;d you all find it (trivial enough?)
Gonna do some of them challenges later</p></blockquote></section><section><h2 id=this-week>This week</h2><ul><li>Local File Inclusion</li><li>Server Side Request Forgery</li><li>Server Side Template Injection</li><li>Reverse Shells</li></ul></section></section><section><section data-shortcode-section><h3 id=local-file-inclusion--server-side-inclusion>Local File Inclusion / Server Side Inclusion</h3><ul><li>Is what it sounds like.</li><li>Getting the server to include a file on a webpage</li><li>Uses includes</li></ul></section><section><p>Demo (Pico CTF) &ldquo;Forbidden Paths&rdquo; (Local File Disclosure)</p></section><section><p>Why is this bad?</p><blockquote><p>../../../../../../etc/passwd</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Get the page to include from the URL parameter
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>$page <span style=color:#f92672>=</span> $_GET[<span style=color:#e6db74>&#39;page&#39;</span>];
</span></span><span style=display:flex><span><span style=color:#75715e>// Include the requested page
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>include</span>($page <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;.html&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><blockquote><p>What if you can upload files and then have them executed? Whats that called?</p></blockquote></section><section><p>How do we fix?</p><blockquote><p>allowlist
santise inputs for &ldquo;../&rdquo;
dont do it?</p></blockquote></section><section></section></section><section><h2 id=ssrf>SSRF</h2><section data-shortcode-section><h3 id=server-side-request-forgery>Server-side request forgery</h3><ul><li>Trick a server into doing stuff it doesn&rsquo;t intend to</li><li>Consider <code>HAAS</code>, we can&rsquo;t access <code>KB</code>, but <code>HAAS</code> could, and we can send requests through <code>HAAS</code></li><li>What if we could access other internal services through <code>HAAS</code>, which aren&rsquo;t expecting it</li></ul></section><section><h3 id=exploitation>Exploitation</h3><ul><li>Internal services might (often will) be less secure than externally facing ones</li><li>What can we do?<ul><li>Retrieve/disclose information (ssi/lfi)</li><li>Remote code execution / Reverse shells?</li><li>Other bad stuff</li></ul></li></ul></section><section><h2 id=demohttpsgithubcomlachlan-waugh6443treemaindemosserver-side-injectionssrf><a href=https://github.com/lachlan-waugh/6443/tree/main/demos/server-side-injection/ssrf>Demo</a></h2></section><section><h3 id=remediation>Remediation</h3><ul><li>Don&rsquo;t assume local/internal services will be safe</li><li>Monitor internal requests, block any suspicious activity<ul><li>e.g. very long execution time could be someone fetchng information from a database</li></ul></li><li>A whitelist of IPs that can access internal services</li><li>A <em>good</em> WAF</li></ul></section></section><section><h2 id=ssti>SSTI</h2><section data-shortcode-section><h3 id=server-side-template-injection>Server-side template injection</h3><ul><li><p>Templating engines (eg. Jinja2, Pug) use templates to inject code and variables into static files</p></li><li><p>Jinja2: <code>{{</code>&lt;CODE HERE><code>}}</code> e.g. <code>{{7*7}}</code> => <code>49</code></p></li><li><p><em>what if we tricked the template rendering into thinking our user-supplied content was code?</em></p></li></ul></section><section><h2 id=demohttpsgithubcomlachlan-waugh6443treemaindemosserver-side-injectionssti><a href=https://github.com/lachlan-waugh/6443/tree/main/demos/server-side-injection/ssti>Demo</a></h2></section><section></section></section><section><h2 id=basic-php-injection>Basic PHP injection</h2><section data-shortcode-section><ul><li>PHP is the worst language in the world</li></ul></section><section><h2 id=demohttpsgithubcomlachlan-waugh6443treemaindemosserver-side-injectionphp_webshell><a href=https://github.com/lachlan-waugh/6443/tree/main/demos/server-side-injection/php_webshell>Demo</a></h2></section></section><section><section data-shortcode-section><h2 id=bash-injection>bash injection</h2><ul><li>If you&rsquo;re ever using os.system() (or similar) to call shell functions containing user input<ul><li>first of all, probably don&rsquo;t</li><li>second of all, it&rsquo;s kinda vulnerable</li></ul></li></ul></section><section><h2 id=demohttpsgithubcomlachlan-waugh6443treemaindemosserver-side-injectionshell_injection><a href=https://github.com/lachlan-waugh/6443/tree/main/demos/server-side-injection/shell_injection>Demo</a></h2></section><section><h2 id=reverse-shells>reverse shells</h2><ul><li>Sometimes you can get command injection, but it&rsquo;s really tedious</li><li>wouldn&rsquo;t it be easier if you could just get send your commands directly via terminal?</li></ul><blockquote><p>checkout <a href="https://www.explainshell.com/explain?cmd=nc+-lnvp+9999">explainshell</a> and <a href=https://revshells.com>revshells</a></p></blockquote></section><section><h2 id=no-demo-on-work-laptop--there-are-plenty-of-challenges-though>No demo on work laptop :( THERE ARE PLENTY OF CHALLENGES THOUGH</h2></section><section></section></section><section><h1 id=ok>Ok</h1><blockquote><p>Midterm walkthrough? Yes or No?</p></blockquote></section><section><h2 id=now-do-some-challenges>Now do some challenges</h2><blockquote><p>What you all came for lol</p></blockquote></section></div></div><script type=text/javascript src=../reveal-hugo/object-assign.js></script><script src=../reveal-js/dist/reveal.js></script><script type=text/javascript src=../reveal-js/plugin/markdown/markdown.js></script><script type=text/javascript src=../reveal-js/plugin/highlight/highlight.js></script><script type=text/javascript src=../reveal-js/plugin/zoom/zoom.js></script><script type=text/javascript src=../reveal-js/plugin/notes/notes.js></script><script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams={},revealHugoPageParams={},revealHugoPlugins={plugins:[RevealMarkdown,RevealHighlight,RevealZoom,RevealNotes]},options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams),camelize(revealHugoPlugins));Reveal.initialize(options)</script></body></html>